{
  "license": {
    "active-feature-license": {
      "query": "SELECT Id, Assignee.CRM_NAV_Ident__c, PermissionSetLicense.MasterLabel, Assignee.Profile.UserLicense.Name, Assignee.LastLoginDate FROM PermissionSetLicenseAssign WHERE Assignee.IsActive = true AND Assignee.Profile.UserLicense.Name IN ('Salesforce', 'Salesforce Platform', 'Customer Community Plus') AND Assignee.CRM_NAV_Ident__c != null",
      "schema": {
        "Id": {
          "name": "id",
          "type": "STRING"
        },
        "Assignee.CRM_NAV_Ident__c": {
          "name": "navIdent",
          "type": "STRING"
        },
        "PermissionSetLicense.MasterLabel": {
          "name": "licenseName",
          "type": "STRING"
        },
        "Assignee.Profile.UserLicense.Name": {
          "name": "userLicenseType",
          "type": "STRING"
        },
        "Assignee.LastLoginDate": {
          "name": "lastLoginAt",
          "type": "DATETIME"
        }
      },
      "fullHistoryCopy": true
    },
    "active-feature-license-metric": {
      "query": "SELECT Id, ActiveUserCount,AssignedUserCount,FeatureType,MetricsDate,TotalLicenseCount FROM ActiveFeatureLicenseMetric",
      "schema": {
        "Id": {
          "name": "id",
          "type": "STRING"
        },
        "ActiveUserCount": {
          "name": "activeUserCount",
          "type": "INTEGER"
        },
        "AssignedUserCount": {
          "name": "assignedUserCount",
          "type": "INTEGER"
        },
        "FeatureType": {
          "name": "featureType",
          "type": "STRING"
        },
        "MetricsDate": {
          "name": "metricsDate",
          "type": "DATE"
        },
        "TotalLicenseCount": {
          "name": "totalLicenseCount",
          "type": "INTEGER"
        }
      },
      "timeSliceFields": "MetricsDate"
    },
    "active-permset-license-metric": {
      "query": "SELECT Id, ActiveUserCount,AssignedUserCount,DeveloperName, PermissionSetLicense.MasterLabel,TotalLicenses, MetricsDate FROM ActivePermSetLicenseMetric",
      "schema": {
        "Id": {
          "name": "id",
          "type": "STRING"
        },
        "ActiveUserCount": {
          "name": "activeUserCount",
          "type": "INTEGER"
        },
        "AssignedUserCount": {
          "name": "assignedUserCount",
          "type": "INTEGER"
        },
        "DeveloperName": {
          "name": "developerName",
          "type": "STRING"
        },
        "PermissionSetLicense.MasterLabel": {
          "name": "licenseName",
          "type": "STRING"
        },
        "TotalLicenses": {
          "name": "totalLicenseCount",
          "type": "INTEGER"
        },
        "MetricsDate": {
          "name": "metricsDate",
          "type": "DATE"
        }
      },
      "timeSliceFields": "MetricsDate"
    },
    "active-salesforce-user-v2": {
      "query": "SELECT Id, CRM_NAV_Ident__c, LastLoginDate, Profile.Name, Profile.UserLicense.Name, UserPermissionsAvantgoUser, UserPermissionsCallCenterAutoLogin, UserPermissionsInteractionUser, UserPermissionsKnowledgeUser, UserPermissionsLiveAgentUser, UserPermissionsMarketingUser, UserPermissionsOfflineUser, UserPermissionsSFContentUser, UserPermissionsSupportUser FROM User WHERE IsActive = true AND Profile.UserLicense.Name IN ('Salesforce', 'Salesforce Platform', 'Customer Community Plus') AND CRM_NAV_Ident__c != null",
      "schema": {
        "Id": {
          "name": "id",
          "type": "STRING"
        },
        "CRM_NAV_Ident__c": {
          "name": "navIdent",
          "type": "STRING"
        },
        "LastLoginDate": {
          "name": "lastLoginAt",
          "type": "DATETIME"
        },
        "Profile.Name": {
          "name": "profileName",
          "type": "STRING"
        },
        "Profile.UserLicense.Name": {
          "name": "userLicenseType",
          "type": "STRING"
        },
        "UserPermissionsAvantgoUser": {
          "name": "avantgoUser",
          "type": "BOOLEAN"
        },
        "UserPermissionsCallCenterAutoLogin": {
          "name": "callCenterAutoLogin",
          "type": "BOOLEAN"
        },
        "UserPermissionsInteractionUser": {
          "name": "interactionUser",
          "type": "BOOLEAN"
        },
        "UserPermissionsKnowledgeUser": {
          "name": "knowledgeUser",
          "type": "BOOLEAN"
        },
        "UserPermissionsLiveAgentUser": {
          "name": "liveAgentUser",
          "type": "BOOLEAN"
        },
        "UserPermissionsMarketingUser": {
          "name": "marketingUser",
          "type": "BOOLEAN"
        },
        "UserPermissionsOfflineUser": {
          "name": "offlineUser",
          "type": "BOOLEAN"
        },
        "UserPermissionsSFContentUser": {
          "name": "sfContentUser",
          "type": "BOOLEAN"
        },
        "UserPermissionsSupportUser": {
          "name": "supportUser",
          "type": "BOOLEAN"
        }
      },
      "timeSliceFields": "LastModifiedDate,LastLoginDate",
      "fullHistoryCopy": true
    },
    "community-user-login-v2": {
      "query": "SELECT Id, LoginTime, NetworkId, UserId FROM LoginHistory WHERE NetworkId != Null",
      "schema": {
        "Id": {
          "name": "id",
          "type": "STRING"
        },
        "LoginTime": {
          "name": "loginAt",
          "type": "DATETIME"
        },
        "NetworkId": {
          "name": "networkId",
          "type": "STRING"
        },
        "UserId": {
          "name": "userId",
          "type": "STRING"
        }
      },
      "timeSliceFields": "LoginTime"
    },
    "community-user-login-daily": {
      "query": "INSERT INTO `${this}` (date, networkId, networkName, logins, uniqueUsers) WITH per_network AS ( SELECT DATE(loginAt) AS date, networkId, COUNT(id) AS logins, COUNT(DISTINCT userId) AS uniqueUsers FROM `${source}` WHERE DATE(loginAt) = '${date}' GROUP BY networkId, DATE(loginAt) ), all_network AS ( SELECT DATE(loginAt) AS date, 'ALL' AS networkId, COUNT(id) AS logins, COUNT(DISTINCT userId) AS uniqueUsers FROM `${source}` WHERE DATE(loginAt) = '${date}' GROUP BY DATE(loginAt) ), combined AS ( SELECT * FROM per_network UNION ALL SELECT * FROM all_network ) SELECT date, networkId, CASE networkId WHEN '0DB2o000000PCSHGA4' THEN 'Tolketjenesten' WHEN '0DB2o000000Ug64GAC' THEN 'Kurs' WHEN '0DB2o000000Ug69GAC' THEN 'nks' WHEN '0DB2o000000Ug6iGAC' THEN 'Aa-registeret' WHEN '0DB2o000000Ug9DGAS' THEN 'Innboks' WHEN '0DB2o000000Ug9IGAS' THEN 'Jobbsporet' WHEN '0DB7U0000004C9mWAE' THEN 'lesehjelp' WHEN '0DB7U0000004C9rWAE' THEN 'lesehjelpAura' WHEN '0DB7U0000004C9wWAE' THEN 'Kontaktskjema' WHEN '0DB7U0000008OIUWA2' THEN 'Tilbakemelding' WHEN '0DB7U0000008OIZWA2' THEN 'TilbakemeldingAura' WHEN '0DB7U000000TN3uWAG' THEN 'Arbeidsgiver Dialog' WHEN '0DB7U000000fxSzWAI' THEN 'innholdsbibliotek' WHEN 'ALL' THEN 'Sum' ELSE 'UKJENT' END AS networkName, logins, uniqueUsers FROM combined",
      "aggregateSource": "platforce-prod-296b.license.community-user-login-v2"
    },
    "community-user-login-hourly": {
      "query": "INSERT INTO `${this}` (date, networkId, networkName, hour, logins) WITH combined AS ( SELECT DATE(loginAt) AS date, networkId, EXTRACT(HOUR FROM loginAt) AS hour, COUNT(id) AS logins FROM `${source}` WHERE DATE(loginAt) = '${date}' GROUP BY networkId, DATE(loginAt), hour UNION ALL SELECT DATE(loginAt) AS date, 'ALL' AS networkId, EXTRACT(HOUR FROM loginAt) AS hour, COUNT(id) AS logins FROM `${source}` WHERE DATE(loginAt) = '${date}' GROUP BY DATE(loginAt), hour ) SELECT date, networkId, CASE networkId WHEN '0DB2o000000PCSHGA4' THEN 'Tolketjenesten' WHEN '0DB2o000000Ug64GAC' THEN 'Kurs' WHEN '0DB2o000000Ug69GAC' THEN 'nks' WHEN '0DB2o000000Ug6iGAC' THEN 'Aa-registeret' WHEN '0DB2o000000Ug9DGAS' THEN 'Innboks' WHEN '0DB2o000000Ug9IGAS' THEN 'Jobbsporet' WHEN '0DB7U0000004C9mWAE' THEN 'lesehjelp' WHEN '0DB7U0000004C9rWAE' THEN 'lesehjelpAura' WHEN '0DB7U0000004C9wWAE' THEN 'Kontaktskjema' WHEN '0DB7U0000008OIUWA2' THEN 'Tilbakemelding' WHEN '0DB7U0000008OIZWA2' THEN 'TilbakemeldingAura' WHEN '0DB7U000000TN3uWAG' THEN 'Arbeidsgiver Dialog' WHEN '0DB7U000000fxSzWAI' THEN 'innholdsbibliotek' WHEN 'ALL' THEN 'Sum' ELSE 'UKJENT' END AS networkName, hour, logins FROM combined",
      "aggregateSource": "platforce-prod-296b.license.community-user-login-v2"
    }
  }
}